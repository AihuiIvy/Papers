# 枚举子域名
Feei<feei#feei.cn> 02/2018

## 1. 背景
开始渗透一个网站前，需要知道网站的网络资产：域名、IP等，而IP和域名有着直接的解析关系，所以如何找到网站所有子域名是关键。

## 2. 解决思路
在知道网站主域名的情况下，可以通过以下几种方式进行域名查找。

### 2.1. 搜索引擎
通过百度、Google、Bing、Yahoo等搜索引擎，可通过搜索引擎中的`site:feei.cn`关键字查询子域名。

以`qq.com`为例，可以通过搜索`site:qq.com`来获取`qq.com`被收录的子域名。

- 百度: `https://www.baidu.com/s?wd=site:qq.com`
- Google: `https://www.google.com.hk/search?q=site:qq.com`
- Bing: `https://www.bing.com/search?q=site:qq.com` 
- Yahoo: `https://search.yahoo.com/search?p=site:qq.com`

缺点：接口性质的子域名可能不会被搜索引擎收录，会有遗漏

### 2.3. Google HTTPS证书透明度
Google的透明度报告中有个[证书透明度项目](https://transparencyreport.google.com/https/certificates)，用来解决HTTPS证书系统的结构性缺陷，使所有人能够查询网站的HTTPS证书信息。
以`qq.com`为例：
https://transparencyreport.google.com/https/certificates?cert_search_auth=&cert_search_cert=&cert_search=include_expired:true;include_subdomains:true;domain:qq.com&lu=cert_search

缺点：对于签根域名的情况，有较多遗漏

### 2.2. 自身泄露


- 流量代理：通过使用测代理全部流量，爬取其中出现的子域名
  - 域名跳转记录中的子域名
  - Response中存在的子域名
  - 网络请求资源中的子域名
- GitHub搜索：`https://github.com/search?o=desc&q=%22qq.com%22&s=indexed&type=Code&utf8=✓`
- DNS域传递：`dig @8.8.8.8 axfr www.qq.com`
- crossdomain.xml：`http://www.qq.com/crossdomain.xml`
- DNSPod：`http://www.dnspod.cn/proxy_diagnose/recordscan/qq.com?callback=feei`

缺点：存在大量遗漏

### 3.4. DNS查询
域名的存在是为了避免让大家记住IP而出现的，因此域名都是对应着IP的。所以可以通过收集常用域名字典，去DNS服务商查询是否有解析记录来枚举子域名。
比如`qq.com`，通过`dig`命令可以看到二级域名`www.qq.com`的DNS解析记录（ANSWER SECTION）。
```
$ dig qq.com
; <<>> DiG 9.9.7-P3 <<>> qq.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 8217
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;qq.com.				IN	A

;; ANSWER SECTION:
qq.com.			556	IN	A	61.135.157.156
qq.com.			556	IN	A	125.39.240.113

;; Query time: 80 msec
;; SERVER: 8.8.8.8#53(8.8.8.8)
;; WHEN: Fri Mar 02 16:32:49 CST 2018
;; MSG SIZE  rcvd: 67
```

## 3. 最佳实践
每种思路都存在漏报的可能，结合起来查询的结果才能最全面。着重说下第四种方式，通过DNS查询来枚举子域名。


## 4. 问题

#### 引用参考
